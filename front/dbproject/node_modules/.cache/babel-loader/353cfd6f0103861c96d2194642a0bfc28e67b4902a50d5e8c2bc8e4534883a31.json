{"ast":null,"code":"import WebSocket from 'ws';\nexport default {\n  data() {\n    return {\n      url: 'ws://localhost:7078/Room/',\n      ws: null,\n      user: '',\n      message: '',\n      content: ''\n    };\n  },\n  created() {},\n  methods: {\n    async joinRoom() {\n      if (this.ws) {\n        alert(\"你已经再聊天室\");\n        return;\n      }\n      let url = this.url;\n      let username = this.user;\n      const TokenKey = Cookies.get(\"Admin-Token\");\n      this.ws = new WebSocket('ws://localhost:7078/Room/' + username, [TokenKey]); // 后端的启动端口\n      this.ws.onopen = this.webscoketonopen;\n      this.ws.onmessage = this.webscoketonmessage;\n      //发生错误触发\n      this.ws.onerror = function (event) {\n        console.log(\"连接错误\" + event);\n      };\n      //正常关闭触发\n      this.ws.onclose = function () {\n        console.log(\"连接关闭\");\n      };\n    },\n    webscoketonopen() {\n      console.log(\"与服务器成功建立连接\");\n    },\n    webscoketonmessage(value) {\n      console.log(value);\n      this.content += value.data + '\\r\\n';\n    },\n    exitRoom() {\n      this.closeWebSocket();\n    },\n    sendMsg() {\n      if (!this.ws) {\n        alert('你已经掉线，请重新加入');\n        return;\n      }\n      if (this.ws.readyState === 1) {\n        this.ws.send(this.message);\n        this.message = '';\n      } else {\n        alert('发送失败');\n      }\n    },\n    closeWebSocket() {\n      if (this.ws) {\n        this.ws.close();\n        this.ws = null;\n      }\n    },\n    talking(content) {\n      console.log(content);\n    }\n  }\n};","map":{"version":3,"names":["WebSocket","data","url","ws","user","message","content","created","methods","joinRoom","alert","username","TokenKey","Cookies","get","onopen","webscoketonopen","onmessage","webscoketonmessage","onerror","event","console","log","onclose","value","exitRoom","closeWebSocket","sendMsg","readyState","send","close","talking"],"sources":["D:\\JavaProject\\Java-EE-Police-Affair-System\\front\\dbproject\\src\\components\\SecretChat.vue"],"sourcesContent":["<template>\r\n    <div class=\"roomStyle\">\r\n    <br>欢迎使用<strong>VueTest</strong>极简聊天室：<br/><br/>\r\n    <textarea id=\"content\" v-model=\"content\" cols=\"60\" rows=\"30\" readonly=\"readonly\"></textarea><br>\r\n    <input type=\"text\" v-model=\"message\">\r\n    <button type=\"button\" @click=\"sendMsg()\">发送消息</button>\r\n    <br/><br/>\r\n    用户：<input type=\"text\" v-model=\"user\">\r\n    <button @click=\"joinRoom()\">加入群聊</button>\r\n    <button @click=\"exitRoom()\">退出群聊</button>\r\n</div>\r\n</template>\r\n<script>\r\nimport WebSocket from 'ws';\r\nexport default {\r\n  data() {\r\n    return {\r\n      url: 'ws://localhost:7078/Room/',\r\n      ws: null,\r\n      user: '',\r\n      message: '',\r\n      content: '',\r\n    }\r\n  },\r\n  created(){\r\n  },\r\n  methods: {\r\n    async joinRoom(){\r\n      if(this.ws) {\r\n        alert(\"你已经再聊天室\");\r\n        return;\r\n      }\r\n      let url = this.url;\r\n      let username = this.user;\r\n      \r\n      const TokenKey = Cookies.get(\"Admin-Token\");\r\n      this.ws = new WebSocket('ws://localhost:7078/Room/' + username,[TokenKey]);  // 后端的启动端口\r\n      this.ws.onopen = this.webscoketonopen;\r\n      this.ws.onmessage =  this.webscoketonmessage;\r\n      //发生错误触发\r\n      this.ws.onerror = function (event) {\r\n        console.log(\"连接错误\"+event)\r\n      };\r\n      //正常关闭触发\r\n      this.ws.onclose = function () {\r\n        console.log(\"连接关闭\");\r\n      };\r\n    }, \r\n    webscoketonopen(){\r\n      console.log(\"与服务器成功建立连接\");\r\n    },\r\n    webscoketonmessage(value){\r\n      console.log(value);\r\n      this.content += (value.data + '\\r\\n') ;\r\n    },\r\n    exitRoom(){\r\n      this.closeWebSocket();\r\n    },\r\n    sendMsg(){\r\n      if(!this.ws) {\r\n        alert('你已经掉线，请重新加入');\r\n        return;\r\n      }\r\n      if(this.ws.readyState === 1){\r\n        this.ws.send(this.message);\r\n        this.message = '';\r\n      } else {\r\n        alert('发送失败');\r\n      }\r\n    },\r\n    closeWebSocket(){\r\n      if(this.ws) {\r\n        this.ws.close();\r\n        this.ws = null;\r\n      }\r\n    },\r\n    talking(content) {\r\n      console.log(content);\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style>\r\n.roomStyle{\r\n  text-align: center;\r\n  background-color: rgba(15, 161, 230, 0.35);\r\n  margin: 0 auto;\r\n  border: 1px solid #000;\r\n  width: 600px;\r\n  height: 650px\r\n}\r\n</style>"],"mappings":"AAaA,OAAOA,SAAQ,MAAO,IAAI;AAC1B,eAAe;EACbC,IAAIA,CAAA,EAAG;IACL,OAAO;MACLC,GAAG,EAAE,2BAA2B;MAChCC,EAAE,EAAE,IAAI;MACRC,IAAI,EAAE,EAAE;MACRC,OAAO,EAAE,EAAE;MACXC,OAAO,EAAE;IACX;EACF,CAAC;EACDC,OAAOA,CAAA,EAAE,CACT,CAAC;EACDC,OAAO,EAAE;IACP,MAAMC,QAAQA,CAAA,EAAE;MACd,IAAG,IAAI,CAACN,EAAE,EAAE;QACVO,KAAK,CAAC,SAAS,CAAC;QAChB;MACF;MACA,IAAIR,GAAE,GAAI,IAAI,CAACA,GAAG;MAClB,IAAIS,QAAO,GAAI,IAAI,CAACP,IAAI;MAExB,MAAMQ,QAAO,GAAIC,OAAO,CAACC,GAAG,CAAC,aAAa,CAAC;MAC3C,IAAI,CAACX,EAAC,GAAI,IAAIH,SAAS,CAAC,2BAA0B,GAAIW,QAAQ,EAAC,CAACC,QAAQ,CAAC,CAAC,EAAG;MAC7E,IAAI,CAACT,EAAE,CAACY,MAAK,GAAI,IAAI,CAACC,eAAe;MACrC,IAAI,CAACb,EAAE,CAACc,SAAQ,GAAK,IAAI,CAACC,kBAAkB;MAC5C;MACA,IAAI,CAACf,EAAE,CAACgB,OAAM,GAAI,UAAUC,KAAK,EAAE;QACjCC,OAAO,CAACC,GAAG,CAAC,MAAM,GAACF,KAAK;MAC1B,CAAC;MACD;MACA,IAAI,CAACjB,EAAE,CAACoB,OAAM,GAAI,YAAY;QAC5BF,OAAO,CAACC,GAAG,CAAC,MAAM,CAAC;MACrB,CAAC;IACH,CAAC;IACDN,eAAeA,CAAA,EAAE;MACfK,OAAO,CAACC,GAAG,CAAC,YAAY,CAAC;IAC3B,CAAC;IACDJ,kBAAkBA,CAACM,KAAK,EAAC;MACvBH,OAAO,CAACC,GAAG,CAACE,KAAK,CAAC;MAClB,IAAI,CAAClB,OAAM,IAAMkB,KAAK,CAACvB,IAAG,GAAI,MAAM;IACtC,CAAC;IACDwB,QAAQA,CAAA,EAAE;MACR,IAAI,CAACC,cAAc,CAAC,CAAC;IACvB,CAAC;IACDC,OAAOA,CAAA,EAAE;MACP,IAAG,CAAC,IAAI,CAACxB,EAAE,EAAE;QACXO,KAAK,CAAC,aAAa,CAAC;QACpB;MACF;MACA,IAAG,IAAI,CAACP,EAAE,CAACyB,UAAS,KAAM,CAAC,EAAC;QAC1B,IAAI,CAACzB,EAAE,CAAC0B,IAAI,CAAC,IAAI,CAACxB,OAAO,CAAC;QAC1B,IAAI,CAACA,OAAM,GAAI,EAAE;MACnB,OAAO;QACLK,KAAK,CAAC,MAAM,CAAC;MACf;IACF,CAAC;IACDgB,cAAcA,CAAA,EAAE;MACd,IAAG,IAAI,CAACvB,EAAE,EAAE;QACV,IAAI,CAACA,EAAE,CAAC2B,KAAK,CAAC,CAAC;QACf,IAAI,CAAC3B,EAAC,GAAI,IAAI;MAChB;IACF,CAAC;IACD4B,OAAOA,CAACzB,OAAO,EAAE;MACfe,OAAO,CAACC,GAAG,CAAChB,OAAO,CAAC;IACtB;EACF;AACF"},"metadata":{},"sourceType":"module","externalDependencies":[]}